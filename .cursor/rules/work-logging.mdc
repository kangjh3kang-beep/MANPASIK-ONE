---
description: 실시간 작업 기록 프로토콜 - 개발 과정/결과/이슈/환경을 CHANGELOG.md/CONTEXT.md에 기록하여 AI 간 실시간 공유
alwaysApply: true
---

# 실시간 작업 기록 프로토콜 (Work Logging Protocol)

> **이 규칙은 모든 에이전트가 모든 세션에서 반드시 준수해야 합니다.**
> 만파식 프로젝트는 3개 AI(Antigravity, Claude, ChatGPT)가 병렬로 작업합니다.
> 한 AI의 작업 결과를 다른 AI가 즉시 파악할 수 있도록 실시간 기록이 필수입니다.

---

## 0. 핵심 원칙: "과정도 결과만큼 중요하다"

> **결과뿐 아니라 개발 과정에서 발생한 모든 이슈, 에러, 디버깅, 환경 문제, 우회 방법을 빠짐없이 기록한다.**
> 이 기록은 동일한 문제 재발 방지, 다른 AI/개발자의 시간 절약, 프로젝트 지식 축적에 핵심적이다.

**반드시 기록해야 하는 항목:**
1. **발생한 에러/이슈**: 에러 메시지, 발생 조건, 영향 범위
2. **디버깅 과정**: 시도한 해결 방법과 결과 (실패한 시도도 포함)
3. **환경/의존성 문제**: OS, 패키지, 빌드 도구, 설정 관련 이슈
4. **우회 방법(Workaround)**: 근본 해결이 아닌 임시 조치와 그 이유
5. **미해결 이슈**: 이번 세션에서 해결하지 못한 문제와 향후 해결 조건

---

## 1. 세션 시작 시 (컨텍스트 로드)

작업 시작 전 반드시 다음 3개 파일을 읽어 최신 프로젝트 상태를 파악합니다:

1. **`CONTEXT.md`** — 프로젝트 현재 상태 요약 (기술 스택, 진행률, 결정 사항, 알려진 이슈)
2. **`CHANGELOG.md`** — 최근 작업 로그 (다른 AI의 작업 결과 + 이슈 확인)
3. **`KNOWN_ISSUES.md`** — 알려진 이슈 목록 (미해결 문제, 환경 제약, 기술 부채)

이를 통해:
- 다른 AI가 최근 무엇을 변경했는지 파악
- **이전에 발생했던 이슈와 해결 방법 확인 (같은 문제 반복 방지)**
- 충돌 방지 (같은 파일 동시 수정 방지)
- 이전 결정 사항 존중

---

## 2. 작업 중 기록 (실시간 — 가장 중요)

### 2.1 이슈 발생 즉시 기록

에러, 빌드 실패, 테스트 실패, 환경 문제 등이 발생하면 **해결 여부와 관계없이 즉시 기억**하고, 세션 종료 시 CHANGELOG.md에 반영합니다.

**기록 대상:**
| 유형 | 예시 | 기록 항목 |
|------|------|----------|
| 빌드 에러 | `cargo build` 실패 | 에러 메시지, 원인, 해결 방법 |
| 의존성 문제 | 크레이트/패키지 누락 | 패키지명, 버전, 설치 명령어 |
| 환경 이슈 | WSL 경로 문제, sudo 필요 | OS/환경 조건, 우회 방법 |
| 테스트 실패 | 특정 테스트 케이스 실패 | 테스트명, 실패 원인, 수정 내용 |
| 런타임 에러 | 서비스 시작 실패 | 에러 로그, 설정 문제 |
| 성능 이슈 | 빌드 시간 과다, 메모리 부족 | 측정값, 원인 분석 |
| 호환성 문제 | 버전 충돌, API 변경 | 관련 버전, 마이그레이션 방법 |
| 설계 변경 | 구현 중 발견된 설계 결함 | 변경 전/후, 변경 이유 |

### 2.2 디버깅 과정 기록

문제 해결에 여러 시도가 필요한 경우, **실패한 시도도 반드시 기록**합니다:
```
시도 1: [방법] → [결과: 실패/성공] → [원인 분석]
시도 2: [방법] → [결과: 실패/성공] → [원인 분석]
최종 해결: [방법] → [성공]
```

---

## 3. 작업 완료 시 (기록 저장)

코드 변경이 수반되는 작업이 완료되면 **반드시** 다음을 수행합니다:

### 3.0 Quality Gate Level 1 의무 (작업 완료 전)

작업을 "완료"로 간주하고 CHANGELOG에 기록하기 **전에** 해당 변경이 적용된 언어/디렉토리에서 Level 1 검증을 실행합니다:

- **린트**: 에러 0개 (경고는 `QUALITY_GATES.md`·기존 허용 목록에 따라 허용 가능)
- **테스트**: 전체 통과
- **빌드**: 성공

검증 명령어는 `QUALITY_GATES.md` 2절 및 `.cursor/rules/manpasik-project.mdc` 9항 참조. **통과하지 못하면 완료로 기록하지 않고, 먼저 수정 후 재검증한다.**

### 3.1 CHANGELOG.md 업데이트

`## 🔄 최근 작업 로그` 섹션 바로 아래에, 기존 항목 위에 새 항목을 추가합니다.

**형식 (강화됨):**
```markdown
## [날짜] [AI명] - [작업 제목]

**상태**: ✅ 완료 / 🔄 진행중 / ⏸️ 대기

**작업 배경:**
- 왜 이 작업을 수행했는지

**변경 사항:**
- `파일경로1`: 변경 설명
- `파일경로2`: 변경 설명

**Level 1 검증:** (필수)
- 린트: 통과 / 경고 N개
- 테스트: N개 통과
- 빌드: 성공 / 실패

**발생 이슈 및 해결:**
- ⚠️ 이슈1: [에러 메시지/증상]
  - 원인: [근본 원인]
  - 해결: [해결 방법] / 우회: [임시 조치]
- ⚠️ 이슈2: [에러 메시지/증상]
  - 시도 1: [방법] → 실패 (이유)
  - 시도 2: [방법] → 성공
  - 근본 원인: [설명]

**환경/의존성 변경:**
- [패키지명] [버전] 설치/업데이트 (이유)
- [시스템 설정] 변경 (이유)

**미해결 이슈:**
- 🔴 [이슈 설명]: [해결 조건/필요 작업]

**결정 사항:**
- 결정1: 이유
- 결정2: 이유

**다음 단계:**
- 다음 작업1
- 다음 작업2 (담당 AI 명시)

---
```

**기록 규칙:**
- AI명: 현재 에이전트의 이름 (Cursor에서 작업 시 "Claude" 사용)
- 변경된 모든 파일을 빠짐없이 기록
- **이슈/에러**: 발생한 모든 이슈를 에러 메시지와 함께 기록 (해결 여부 불문)
- **디버깅**: 여러 시도가 필요했다면 실패한 시도도 포함
- **환경 변경**: 패키지 설치, 시스템 설정 등 개발 환경 변경 사항 기록
- **미해결 이슈**: 해결하지 못한 문제는 반드시 명시 (다음 세션에서 이어받기 위해)
- 결정 사항: 왜 그렇게 결정했는지 이유 포함
- 다음 단계: 후속 작업자(AI)가 무엇을 해야 하는지 명시
- **Level 1 검증**: 해당 작업에 대해 실행한 린트/테스트/빌드 결과를 반드시 기록

**Stage 완료 시 추가:** 해당 Stage가 완료된 경우 `QUALITY_GATES.md`의 Stage Gate 체크리스트(3.2절)를 수행하고, 체크리스트 결과를 CHANGELOG 항목에 요약 기록. `QUALITY_GATES.md` 5절 "현재 Stage 상태 추적" 테이블을 해당 Stage 통과로 갱신.

### 3.2 KNOWN_ISSUES.md 업데이트

미해결 이슈가 있거나, 기존 이슈가 해결된 경우 `KNOWN_ISSUES.md`를 업데이트합니다:
- 새 이슈 발견 시: 항목 추가
- 기존 이슈 해결 시: 상태를 `✅ 해결됨`으로 변경하고 해결 방법 기록
- **절대 이슈를 삭제하지 않는다** (해결 이력도 지식이다)

### 3.3 CONTEXT.md 업데이트

다음 항목이 변경된 경우 `CONTEXT.md`를 업데이트합니다:

| 변경 유형 | 업데이트 대상 |
|----------|-------------|
| 새 기능 구현 | `📍 현재 진행 단계` 체크리스트 |
| 기술 스택 변경 | `🔧 기술 스택` 테이블 |
| 아키텍처 결정 | `📋 핵심 결정 사항` 목록 |
| AI 역할 변경 | `🤖 AI 역할 분담` 테이블 |
| 에이전트 규칙 변경 | `🛡️ Cursor 에이전트 팀` 테이블 |
| 환경/의존성 변경 | `🔧 기술 스택` 또는 `📋 핵심 결정 사항` |
| Stage/Phase 완료 | `QUALITY_GATES.md` 5절 Stage 상태 갱신 + `CONTEXT.md` 진행률 |
| 마지막 줄 | `**마지막 업데이트**: 날짜 (AI명)` |

### 3.4 CHANGELOG.md 하단 현황 테이블 업데이트

`## 📊 프로젝트 현황 요약` 테이블의 진행률을 실제 변경에 맞게 갱신합니다.

---

## 4. 대규모 작업 시 (중간 기록)

작업이 30분 이상 소요되거나 여러 단계로 구성된 경우:
- 각 주요 단계 완료 시 **중간 기록**을 남깁니다
- 상태를 `🔄 진행중`으로 표기합니다
- **이슈가 발생하면 즉시 기록에 반영합니다**
- 최종 완료 시 상태를 `✅ 완료`로 변경합니다

---

## 5. 기록 품질 기준

### 좋은 기록 예시 (이슈 포함)
```markdown
## 2026-02-10 Claude - Rust 코어 엔진 전체 빌드 검증

**상태**: ✅ 완료

**변경 사항:**
- `rust-core/manpasik-engine/Cargo.toml`: `futures = "0.3"` 의존성 추가

**발생 이슈 및 해결:**
- ⚠️ `tflitec` 빌드 실패: "Cannot find bazel"
  - 원인: tflitec는 Bazel + TensorFlow 소스 빌드 필요
  - 시도 1: numpy 설치 → Python import는 해결, Bazel 여전히 필요
  - 우회: AI 제외(`--no-default-features --features 'std,ble,nfc,fingerprint'`)로 빌드
- ⚠️ BLE 모듈 컴파일 에러: `unresolved module futures`
  - 원인: `futures` 크레이트가 Cargo.toml에 미포함
  - 해결: `futures = "0.3"` 의존성 추가

**환경/의존성 변경:**
- `numpy 2.4.2` 설치 (pip3, system python) — tflitec 빌드 스크립트 요구
- `futures 0.3` Cargo 의존성 추가 — BLE 비동기 스트림 처리

**미해결 이슈:**
- 🔴 `cargo build --features full` 실패: Bazel 미설치 → 실제 TFLite 추론 필요 시 Bazel 설치 필요

**결정 사항:**
- AI TFLite 네이티브 빌드는 시뮬레이션 모드로 충분, Bazel 설치 보류

**다음 단계:**
- Claude: FMEA 초안 작성
---
```

### 나쁜 기록 예시 (금지)
```markdown
## 2026-02-10 - 작업 완료
코드 수정함. 빌드 됨.
```

---

## 6. 공유 문서 충돌 방지

여러 AI가 동시에 작업할 수 있으므로:
- CHANGELOG.md: 항상 **최상단에 추가** (append-top) — 다른 항목 수정 금지
- CONTEXT.md: 자신의 작업 관련 섹션만 업데이트 — 다른 AI의 상태 변경 금지
- KNOWN_ISSUES.md: 자신이 발견/해결한 이슈만 추가/업데이트 — 다른 AI의 이슈 삭제 금지
- 다른 AI의 기존 기록을 삭제하거나 수정하지 않는다

---

## 7. 참조 파일 경로

| 파일 | 용도 | 업데이트 주기 |
|------|------|-------------|
| `CHANGELOG.md` | 작업 로그 + 이슈/에러 기록 (시간순, 최신 상단) | 매 작업 완료 시 |
| `CONTEXT.md` | 프로젝트 현재 상태 요약 | 상태 변경 시 |
| `KNOWN_ISSUES.md` | 알려진 이슈/기술 부채/환경 제약 추적 | 이슈 발견/해결 시 |
| `QUALITY_GATES.md` | Quality Gate 프로세스, Stage/Phase 체크리스트, Stage 상태 | Stage/Phase 완료 시 |
| `AGENTS.md` | 에이전트 팀 마스터 컨텍스트 | 아키텍처/API 변경 시 |
| `docs/AI_COLLABORATION.md` | 3-AI 역할 분담 | 역할 변경 시 |
