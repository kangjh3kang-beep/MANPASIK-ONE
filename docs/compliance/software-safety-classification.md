# 만파식 소프트웨어 안전 등급 판정서

> **문서 ID**: MPS-QMS-SSC-001
> **표준 근거**: IEC 62304:2006+AMD1:2015 (의료기기 소프트웨어 — 소프트웨어 수명주기 프로세스)
> **작성일**: 2026-02-09
> **작성자**: Claude (Regulatory & Security Analysis)
> **검토 상태**: 초안 (Internal Review 필요)

---

## 1. 제품 식별

| 항목 | 내용 |
|------|------|
| 제품명 | ManPaSik (만파식) AI Healthcare Ecosystem |
| 의료기기 분류 | 체외진단의료기기 (IVD, In Vitro Diagnostic) |
| 위험 등급 | Class II (중등도 위험) |
| 소프트웨어 유형 | SaMD (Software as a Medical Device) + SiMD 보조 |
| 버전 | 0.1.0 (MVP 개발 중) |
| 의도된 사용 | 혈액/타액/체액/소변/환경 시료에서 바이오마커를 분석하여 건강 상태 정보를 제공 |

---

## 2. IEC 62304 소프트웨어 안전 등급 분류

### 2.1 분류 기준 (IEC 62304 Section 4.3)

IEC 62304는 소프트웨어 안전 등급을 다음과 같이 3단계로 분류합니다:

| 등급 | 정의 | 위해 가능성 |
|------|------|-----------|
| **Class A** | 위해를 유발하거나 기여할 수 없음 | 없음 |
| **Class B** | 위해를 유발하거나 기여할 수 있으나 **심각하지 않음** | 중등도 |
| **Class C** | 사망 또는 심각한 부상을 유발하거나 기여할 수 있음 | 심각 |

### 2.2 만파식 위해 분석

#### 소프트웨어 기능별 위해 시나리오

| # | 소프트웨어 기능 | 잠재적 위해 | 심각도 | 발생 확률 | 등급 판정 |
|---|---------------|-----------|--------|---------|---------|
| H1 | 차동측정 연산 (S_det - α × S_ref) | 잘못된 보정으로 부정확한 측정 결과 → 사용자의 잘못된 건강 판단 | 중등도 | 낮음 | **Class B** |
| H2 | 핑거프린트 분류 (AI 추론) | 잘못된 분류로 부정확한 건강 지표 표시 → 부적절한 자가 관리 | 중등도 | 중간 | **Class B** |
| H3 | 카트리지 유효성 검증 (NFC) | 만료/위조 카트리지 미감지 → 부정확한 결과 | 중등도 | 낮음 | **Class B** |
| H4 | BLE 데이터 전송 | 데이터 손실/변조 → 부정확한 결과 기록 | 중등도 | 낮음 | **Class B** |
| H5 | 건강 데이터 표시 (UI) | 잘못된 단위/형식 표시 → 사용자 오해 | 중등도 | 낮음 | **Class B** |
| H6 | AI 코치 건강 조언 | 부적절한 건강 조언 → 부적절한 자가 관리 | 중등도 | 중간 | **Class B** |
| H7 | 데이터 동기화 (CRDT) | 데이터 유실/충돌 → 불완전한 건강 기록 | 낮음 | 낮음 | **Class A** |
| H8 | 구독/결제 관리 | 서비스 접근 차단 → 건강 모니터링 중단 | 낮음 | 낮음 | **Class A** |
| H9 | 알림/경보 시스템 | 위험 수치 알림 누락 → 대응 지연 | 중등도~심각 | 낮음 | **Class B~C** |

#### 위해 심각도 기준

| 심각도 | 정의 | 해당 시나리오 |
|--------|------|-------------|
| 무시 가능 | 불편함, 일시적 불쾌 | 서비스 접근 차단 |
| 경미 | 일시적, 가역적 위해 | - |
| **중등도** | **의료 개입 필요할 수 있는 위해** | **H1-H6 (잘못된 측정/분류/표시)** |
| 심각 | 영구적 장애/생명 위협 | H9 (위험 수치 알림 누락 시) |

### 2.3 최종 판정

```
┌──────────────────────────────────────────────────────┐
│                                                        │
│   만파식 소프트웨어 안전 등급: Class B                    │
│                                                        │
│   근거:                                                │
│   1. 대다수 기능이 "중등도 위해" 가능성을 가짐            │
│   2. 직접적 치료 결정이 아닌 정보 제공 목적               │
│   3. 의료 전문가 확인 없이 자가 관리에 사용될 수 있음      │
│   4. 다만, 알림/경보 기능은 Class C로 상향 검토 필요      │
│                                                        │
│   ※ 알림/경보 서브시스템: Class C 별도 관리 권고           │
│                                                        │
└──────────────────────────────────────────────────────┘
```

**참고**: IEC 62304 AMD1 기준, 위험 완화 조치(Risk Control Measures)를 통해 Class C를 Class B로 낮출 수 있음. 단, 이를 위해서는 ISO 14971에 따른 문서화된 위험관리 프로세스가 필수.

---

## 3. Class B 소프트웨어 개발 요구사항

### 3.1 IEC 62304 Class B 필수 활동

| 절 | 활동 | Class A | Class B | Class C | 현재 상태 |
|----|------|---------|---------|---------|---------|
| 5.1 | 소프트웨어 개발 계획 | ✅ | ✅ | ✅ | 🟡 부분 (AGENTS.md/CONTEXT.md) |
| 5.2 | 소프트웨어 요구사항 분석 | ✅ | ✅ | ✅ | 🟡 부분 (Proto/스펙 문서) |
| 5.3 | 소프트웨어 아키텍처 설계 | - | ✅ | ✅ | 🟡 부분 (AGENTS.md) |
| 5.4 | 소프트웨어 상세 설계 | - | - | ✅ | N/A (Class B 불필요) |
| 5.5 | 소프트웨어 단위 구현 | ✅ | ✅ | ✅ | 🟡 진행중 |
| 5.6 | 소프트웨어 통합 및 통합 시험 | - | ✅ | ✅ | ❌ 미시작 |
| 5.7 | 소프트웨어 시스템 시험 | ✅ | ✅ | ✅ | ❌ 미시작 |
| 5.8 | 소프트웨어 릴리스 | ✅ | ✅ | ✅ | ❌ 미시작 |
| 6 | 소프트웨어 유지보수 | ✅ | ✅ | ✅ | ❌ 미시작 |
| 7 | 소프트웨어 위험관리 | ✅ | ✅ | ✅ | ❌ 미시작 |
| 8 | 소프트웨어 형상관리 | ✅ | ✅ | ✅ | 🟡 부분 (Git 사용, SOP 없음) |
| 9 | 소프트웨어 문제 해결 | ✅ | ✅ | ✅ | ❌ 미시작 |

### 3.2 Class B에서 면제되는 활동

- 소프트웨어 상세 설계 (5.4) — Class C에서만 필수
- 다만 복잡한 안전 관련 모듈(차동측정, AI 추론)은 상세 설계 권고

### 3.3 SOUP (Software of Unknown Provenance) 관리

Class B에서는 SOUP 목록 작성 및 위험 평가가 필수입니다.

#### 핵심 SOUP 목록

| SOUP 이름 | 버전 | 용도 | 안전 등급 영향 | 관리 방안 |
|----------|------|------|-------------|---------|
| Rust std | Ed.2021 | 코어 런타임 | 직접 | CVE 모니터링 (cargo-audit) |
| tflitec | 0.5 | AI 추론 | 직접 | 모델 검증 프로세스 |
| btleplug | 0.11 | BLE 통신 | 직접 | 프로토콜 검증 |
| ring | 0.17 | 암호화 | 직접 | FIPS 인증 확인 |
| sha2 | 0.10 | 해시 | 직접 | 알고리즘 검증 |
| Flutter | 3.x | UI 프레임워크 | 간접 | 표시 검증 |
| Riverpod | 2.4.x | 상태관리 | 간접 | 상태 일관성 테스트 |
| Go std | 1.22+ | 백엔드 런타임 | 간접 | CVE 모니터링 |
| gRPC | latest | 통신 | 간접 | 프로토콜 검증 |
| PostgreSQL | 16 | 데이터 저장 | 간접 | 데이터 무결성 검증 |
| Keycloak | 25.0 | 인증 | 간접 | 접근제어 검증 |
| Kong | 3.7 | API Gateway | 간접 | 보안 설정 검증 |

---

## 4. 위험관리 파일 목차 (ISO 14971:2019)

### Risk Management File Structure

```
docs/risk-management/
├── 01-risk-management-plan.md          # 위험관리 계획서
│   ├── 범위 및 적용 범위
│   ├── 위험관리 활동 할당
│   ├── 위험 수용 기준
│   ├── 검증 활동
│   └── 생산 및 생산 후 정보 수집 활동
│
├── 02-intended-use.md                   # 의도된 사용 정의
│   ├── 의도된 사용 명세
│   ├── 합리적으로 예상 가능한 오용
│   ├── 사용 환경 (가정/의원/병원)
│   └── 사용자 프로필 (일반인/의료진)
│
├── 03-hazard-identification.md          # 위해 식별
│   ├── 정상 사용 시 위해
│   ├── 고장 시 위해
│   ├── 오용 시 위해
│   └── 위해 요소 분류
│
├── 04-risk-estimation.md                # 위험 추정
│   ├── 각 위해 시나리오별 심각도
│   ├── 각 위해 시나리오별 발생 확률
│   └── 위험 수준 매트릭스 (5×5)
│
├── 05-risk-evaluation.md                # 위험 평가
│   ├── 위험 수용 여부 판단
│   └── 추가 위험 완화 필요 항목
│
├── 06-risk-control.md                   # 위험 통제
│   ├── 설계에 의한 위험 완화
│   │   ├── 이중 검증 로직 (차동측정 결과)
│   │   ├── 카트리지 유효성 다중 체크
│   │   └── 데이터 무결성 해시체인
│   ├── 보호 수단
│   │   ├── 비정상 값 알림
│   │   ├── "의료 전문가 확인 권고" 경고 표시
│   │   └── 자동 재측정 제안
│   └── 사용 정보 (라벨링/IFU)
│       ├── 사용 제한 사항 고지
│       └── 진단 목적이 아닌 정보 제공 고지
│
├── 07-residual-risk-evaluation.md       # 잔여 위험 평가
│   ├── 전체 잔여 위험 수용 가능성
│   └── 위험-편익 분석
│
├── 08-risk-management-report.md         # 위험관리 보고서
│   ├── 위험관리 계획 이행 결과
│   ├── 전체 잔여 위험 수용 가능 결론
│   └── 생산 후 감시 계획
│
├── 09-fmea-analysis.md                  # FMEA (고장 모드 영향 분석)
│   ├── 소프트웨어 FMEA
│   ├── 하드웨어-소프트웨어 인터페이스 FMEA
│   └── 사용자 인터페이스 FMEA
│
├── 10-fault-tree-analysis.md            # FTA (결함 트리 분석)
│   ├── 잘못된 측정 결과 FTA
│   ├── 데이터 유실 FTA
│   └── 보안 침해 FTA
│
└── appendices/
    ├── A-hazard-situation-matrix.md     # 위해 상황 매트릭스
    ├── B-risk-acceptance-criteria.md    # 위험 수용 기준
    ├── C-soup-risk-assessment.md        # SOUP 위험 평가
    └── D-traceability-matrix.md         # 추적성 매트릭스
```

### 위험 수용 기준 (Risk Acceptance Criteria)

| 심각도 \ 발생확률 | 극히 드묾 | 드묾 | 가끔 | 빈번 | 매우 빈번 |
|-----------------|---------|------|------|------|---------|
| **무시 가능** | 수용 | 수용 | 수용 | 수용 | ALARP |
| **경미** | 수용 | 수용 | ALARP | ALARP | 불수용 |
| **중등도** | 수용 | ALARP | ALARP | 불수용 | 불수용 |
| **심각** | ALARP | ALARP | 불수용 | 불수용 | 불수용 |
| **치명적** | ALARP | 불수용 | 불수용 | 불수용 | 불수용 |

- **수용**: 추가 위험 완화 불필요
- **ALARP**: As Low As Reasonably Practicable — 합리적으로 가능한 한 낮춰야 함
- **불수용**: 반드시 위험 완화 조치 필요

---

## 5. 서브시스템별 안전 등급 할당 (IEC 62304 Section 5.3.3)

> IEC 62304 5.3.3: "소프트웨어 아키텍처의 각 소프트웨어 아이템에 소프트웨어 안전 등급을 할당해야 한다."

### 5.1 Rust 코어 엔진 모듈별 등급

| 모듈 | 기능 | 관련 위해 | 안전 등급 | 근거 | 요구 테스트 수준 |
|------|------|---------|---------|------|---------------|
| `differential` | 차동측정 연산 (S_det - α × S_ref) | H1: 부정확한 측정 → 잘못된 건강 판단 | **Class B** | 측정 정확성이 직접적으로 건강 정보 품질에 영향 | 유닛 + 통합 + 경계값 |
| `fingerprint` | 핑거프린트 벡터 생성/분류 | H2: 잘못된 분류 → 부적절한 자가 관리 | **Class B** | AI 추론 입력 데이터의 품질 결정 | 유닛 + 통합 |
| `ai` | TFLite 엣지 추론 (5종 모델) | H2: 잘못된 분류/예측 → 부적절한 건강 지표 | **Class B** | 건강 지표 도출의 핵심 경로 | 유닛 + 모델 검증 + 회귀 |
| `ble` | BLE 5.0 GATT 통신 | H4: 데이터 손실/변조 → 부정확한 기록 | **Class B** | 측정 데이터 전송의 신뢰성 | 유닛 + 프로토콜 + 통합 |
| `nfc` | NFC 카트리지 인식/검증 | H3: 만료/위조 카트리지 → 부정확한 결과 | **Class B** | 측정 전 보정 데이터의 무결성 | 유닛 + 통합 |
| `crypto` | AES-256-GCM + SHA-256 해시체인 | 데이터 기밀성/무결성 | **Class B** | PHI 보호 실패 시 규정 위반 + 프라이버시 침해 | 유닛 + 암호 정확성 |
| `dsp` | FFT + 디지털 필터 | H1 보조: 신호 처리 품질 | **Class B** | 전자코/전자혀 분석의 전처리 | 유닛 + 수치 정확성 |
| `sync` | CRDT 오프라인 동기화 | H7: 데이터 유실/충돌 | **Class A** | 건강 기록 불완전 (심각하지 않음) | 유닛 |
| `lib.rs` | 핵심 타입 정의 + 상수 | 모든 위해의 기반 | **Class B** | MAX_CHANNELS, DEFAULT_ALPHA 등 핵심 상수 | 유닛 |
| `flutter-bridge` | FFI 브리지 (Rust↔Flutter) | 데이터 직렬화/역직렬화 | **Class B** | 데이터 변환 과정에서 정확성 필수 | 유닛 + 통합 |

### 5.2 Go 마이크로서비스별 등급

| 서비스 | 기능 | 관련 위해 | 안전 등급 | 근거 |
|--------|------|---------|---------|------|
| `auth-service` | JWT 인증, Keycloak OIDC | 접근제어 실패 → PHI 무단 접근 | **Class B** | 보안 인프라 |
| `user-service` | 사용자 프로필, 구독 관리 | H8: 서비스 접근 차단 | **Class A** | 건강 데이터에 직접 영향 없음 |
| `device-service` | 리더기 등록, OTA, 상태 관리 | H3 보조: 디바이스 식별 | **Class B** | 잘못된 디바이스 데이터 → 측정 신뢰성 |
| `measurement-service` | 측정 세션, 데이터 저장, 벡터 저장 | H1: 측정 데이터 처리 핵심 경로 | **Class B** | 가장 높은 안전 관련성 |
| `gateway` | HTTP/gRPC 라우팅, 레이트리밋 | 가용성 | **Class A** | 라우팅 자체는 데이터 변형 없음 |

### 5.3 Flutter 앱 모듈별 등급

| 모듈 | 기능 | 관련 위해 | 안전 등급 | 근거 |
|------|------|---------|---------|------|
| `features/measurement` | 측정 화면, 결과 표시 | H5: 잘못된 단위/형식 → 사용자 오해 | **Class B** | 건강 데이터 표시의 정확성 |
| `features/home` | 대시보드, 트렌드 차트 | H5 보조: 시각화 정확성 | **Class B** | 추이 표시가 건강 판단에 영향 |
| `features/ai_coach` | AI 코치, 건강 조언 | H6: 부적절한 건강 조언 | **Class B** | 사용자 행동 변화 유도 |
| `features/devices` | 디바이스 관리, BLE 연결 | H4 보조: 연결 안정성 | **Class B** | BLE 연결 상태가 측정에 영향 |
| `features/auth` | 로그인, 회원가입 | 보안 관련 | **Class A** | 인증 자체는 위해 비유발 |
| `features/settings` | 설정, 알림 관리 | H9 보조: 알림 설정 | **Class B*** | *알림 경보 서브시스템 Class C 검토 필요 |
| `features/data_hub` | 건강 기록, 내보내기 | 데이터 정확성 | **Class B** | FHIR R4 호환 데이터 |
| `features/market` | 마켓플레이스 | 없음 | **Class A** | 건강 데이터 무관 |
| `features/community` | 커뮤니티 | 없음 | **Class A** | 건강 데이터 무관 |
| `core/router` | 라우팅 | 없음 | **Class A** | 네비게이션만 |
| `core/theme` | UI 테마 | 없음 | **Class A** | 시각적 스타일만 |

### 5.4 알림/경보 서브시스템 Class C 분리 분석

```
⚠️ H9 (알림/경보) 분석:

시나리오: 혈당 측정 후 위험 수치(저혈당 < 70mg/dL 또는 고혈당 > 300mg/dL)에서
         알림이 누락되면 사용자가 적절한 대응을 하지 못하여 심각한 건강 위해 가능

판정:
  - 만파식이 "진단 기기"가 아닌 "정보 제공 기기"임을 전제
  - 사용자가 만파식 알림에만 의존하지 않음 (의료진 진료 병행)
  - 제품 라벨에 "의료 진단 목적이 아님" 명시

결론:
  - 알림/경보 기능 → Class B (위험 완화 조치 적용 시)
  - 위험 완화 조치:
    1. "이 알림은 참고용이며, 의료 진단을 대체하지 않습니다" 문구 필수 표시
    2. 측정 결과 화면에 "의료진 상담 권고" 표시 (비정상 수치 시)
    3. 알림 전송 실패 시 재시도 로직 (3회 + 대체 경로)
    4. 알림 전송 감사 로그 기록
  - 만약 향후 "진단 기기"로 포지셔닝 변경 시 → Class C 상향 + 상세 설계(5.4) 필수
```

### 5.5 등급별 요약

| 안전 등급 | 서브시스템 수 | 주요 모듈 |
|---------|------------|---------|
| **Class B** | 19개 | differential, fingerprint, ai, ble, nfc, crypto, dsp, auth-service, device-service, measurement-service, measurement UI, home, ai_coach, devices, settings, data_hub, flutter-bridge, lib.rs |
| **Class A** | 8개 | sync, user-service, gateway, auth UI, market, community, router, theme |

---

## 6. 다음 단계

1. **위험관리 계획서 작성** (01-risk-management-plan.md)
2. **의도된 사용 정의서 작성** (02-intended-use.md)
3. **위해 식별 실시** (03-hazard-identification.md)
4. **SOUP 위험 평가** (appendices/C-soup-risk-assessment.md)
5. **알림/경보 서브시스템 Class C 분리 분석**

---

**Document Version**: 1.0.0
**Next Review**: 2026-02-16 (1주 후)
**Approval Required**: 품질관리 책임자 (QA Lead)
