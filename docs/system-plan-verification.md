# 만파식 시스템 구축 기획/계획안 검증 분석 보고서

> **작성일**: 2026-02-09
> **작성자**: Claude (Security & Architecture Agent)
> **분석 범위**: 전체 코드베이스, 문서, 인프라, 기획안 전수 검증
> **목적**: 현 기획/계획안의 완성도, 갭, 리스크를 식별하고 다음 단계 우선순위를 결정

---

## 1. 검증 요약 (Executive Summary)

### 1.1 전체 현황

| 영역 | 계획 완성도 | 구현 완성도 | 위험도 | 평가 |
|------|-----------|-----------|--------|------|
| 프로젝트 구조 | ✅ 100% | ✅ 100% | 🟢 낮음 | 양호 |
| Rust 코어 엔진 | ✅ 100% | 🟡 70% | 🟡 중간 | 스텁 3개 모듈 완성 필요 |
| Flutter FFI 브리지 | ✅ 100% | ✅ 95% | 🟢 낮음 | 양호 |
| gRPC Proto 정의 | ✅ 100% | ✅ 100% | 🟢 낮음 | 양호 |
| Docker 인프라 | ✅ 100% | ✅ 100% | 🟢 낮음 | 양호 |
| Go 백엔드 서비스 | 🟡 80% | 🔴 5% | 🔴 높음 | 비즈니스 로직 미구현 |
| Flutter 앱 | 🟡 70% | 🔴 3% | 🔴 높음 | 진입점만 존재 |
| 의료 규정 분석 | ✅ 100% | 🟡 40% | 🟡 중간 | 안전등급+체크리스트+데이터보호 완료, 위험관리 계획서/V&V/임상 미착수 |
| 보안 아키텍처 | ✅ 100% | 🟡 45% | 🟡 중간 | STRIDE+암호화정책+RBAC+IRP 완료, 구현 검증/침투테스트 미착수 |
| AI/ML 파이프라인 | 🔴 10% | 🔴 0% | 🟡 중간 | Phase 2 대상 |
| 테스트 | 🟡 50% | 🔴 15% | 🔴 높음 | 커버리지 80% 미달 |
| CI/CD | 🟡 70% | 🔴 0% | 🟡 중간 | 규칙에 정의됨, 구현 없음 |

### 1.2 핵심 발견 사항

- **긍정적**: Rust 코어 엔진의 핵심 알고리즘(차동측정, 핑거프린트)이 완성되어 기술적 리스크가 크게 감소
- **주의 필요**: 의료기기 규정 산출물이 전무하여, 인허가 일정에 직접적 영향
- **긴급**: 암호화 모듈(AES-256-GCM) 미구현 상태에서 PHI 데이터 처리 불가

---

## 2. 상세 갭 분석 (Gap Analysis)

### 2.1 누락된 문서 (Critical)

| 문서 | 계획 참조 위치 | 상태 | 위험도 |
|------|--------------|------|--------|
| `implementation_plan.md` | CHANGELOG (Antigravity 작성 언급) | ❌ 파일 없음 | 🔴 높음 |
| `docs/ai-specs/claude/ml-model-design-spec.md` | `AI_COLLABORATION.md` L98 | ❌ 파일 없음 | 🟡 중간 |
| `docs/ai-specs/chatgpt/db-schema-spec.md` | `AI_COLLABORATION.md` L102 | ❌ 파일 없음 | 🟡 중간 |
| SQL 마이그레이션 파일 | Go 서비스 스펙 산출물 목록 | ❌ 디렉토리 없음 | 🔴 높음 |
| OpenAPI 문서 | `AI_COLLABORATION.md` Claude 역할 | ❌ 없음 | 🟡 중간 |

**분석**: `implementation_plan.md`가 CHANGELOG에 "v2.0 작성 완료"로 기록되어 있으나 실제 파일이 존재하지 않음. 삭제되었거나 경로가 다른 가능성 있음. 이 문서는 24개월 5단계 로드맵과 예산 67억원의 근거 자료로, 부재 시 의사결정 추적이 불가.

### 2.2 Rust 코어 엔진 갭

| 모듈 | 계획 | 실제 | 갭 | 우선순위 |
|------|------|------|-----|---------|
| `crypto` | AES-256-GCM + SHA-256 해시체인 + E2E 암호화 | SHA-256만 구현 (34줄) | AES 미구현 | 🔴 P0 (의료데이터 보호 필수) |
| `dsp` | FFT + 디지털 필터 (rustfft 기반) | 빈 스텁 (36줄) | 전체 미구현 | 🟡 P1 (전자코/혀 분석에 필요) |
| `sync` | CRDT 기반 오프라인 동기화 | 빈 스텁 (82줄) | 전체 미구현 | 🟡 P2 (Phase 2) |
| `ai` | TFLite 5종 모델 추론 | 시뮬레이션 모드 | 실제 모델 로드 미구현 | 🟡 P1 |
| `ble` | BLE 5.0 Secure Connections | 파싱 완료, 하드웨어 연동 미완 | 실제 BLE 통신 미구현 | 🟡 P1 |
| `nfc` | ISO 14443A + MIFARE DESFire | 파싱 완료, 하드웨어 연동 미완 | 실제 NFC 읽기/쓰기 미구현 | 🟡 P1 |

**분석**: `crypto` 모듈의 AES-256-GCM 미구현은 **의료기기 인허가 차단 요소**. PHI 데이터를 처리하는 모든 경로에서 암호화가 필수이며, HIPAA/GDPR/PIPA 모두 전송 중 및 저장 중 암호화를 요구함. 이 모듈은 즉시 구현이 필요.

### 2.3 Go 백엔드 서비스 갭

| 서비스 | 계획 구조 | 실제 | 갭 |
|--------|---------|------|-----|
| auth-service | cmd + internal/{handler,service,repository,model} | `cmd/main.go`만 (스텁 105줄) | handler/service/repository 전무 |
| user-service | 동일 | `cmd/main.go`만 (스텁 122줄) | handler/service/repository 전무 |
| device-service | 동일 | `cmd/main.go`만 (스텁 142줄) | handler/service/repository 전무 |
| measurement-service | 동일 | `cmd/main.go`만 (스텁 102줄) | handler/service/repository 전무 |
| gateway | HTTP + gRPC Routing | 기본 HTTP만 (112줄) | gRPC 라우팅 미구현 |

**추가 발견 사항:**
- Proto에서 Go 코드 자동 생성(protoc) 미실행 — `backend/shared/proto/gen/` 디렉토리 부재
- `backend/go.mod`에 의존성 정의되어 있으나 `go.sum` 미생성 (의존성 미설치)
- SQL 마이그레이션 도구(golang-migrate 등) 미선정
- 27개 서비스 디렉토리 중 4개만 코드 존재 (나머지 23개는 빈 디렉토리)

### 2.4 Flutter 앱 갭

| 항목 | 계획 | 실제 | 갭 |
|------|------|------|-----|
| 프로젝트 설정 | pubspec.yaml + main.dart | ✅ 존재 | 양호 |
| 라우터 | `lib/core/router/app_router.dart` | ❌ 없음 | main.dart에서 import하고 있으나 파일 부재 |
| 테마 | `lib/core/theme/app_theme.dart` | ❌ 없음 | main.dart에서 import하고 있으나 파일 부재 |
| Feature 구조 | 10개 feature 디렉토리 | ❌ 없음 | 전체 미생성 |
| 화면 | 12개 화면 | ❌ 없음 | 전체 미구현 |
| 다국어 | l10n ARB 파일 | ❌ 없음 | 미생성 |
| 에셋 | assets/images/, assets/fonts/ | ❌ 없음 | 디렉토리 미생성 |

**분석**: `main.dart`가 `app_router.dart`와 `app_theme.dart`를 import하고 있으나 해당 파일이 존재하지 않음. **현재 상태에서 빌드 불가**. 또한 스펙에는 일본어(ja)와 중국어(zh) 로케일이 포함되어 있으나 실제 main.dart에는 한국어/영어만 등록됨.

### 2.5 데이터베이스 스키마 갭

| 문제 | 상세 | 영향도 |
|------|------|--------|
| `tenant_id` 누락 | 프로젝트 규칙에 "Multi-tenancy 구조, tenant_id 필수"로 명시되어 있으나 모든 테이블에서 누락 | 🔴 아키텍처 결정 필요 |
| PostGIS 미포함 | 사용자 규칙에 "PostgreSQL + PostGIS" 명시되어 있으나 Docker Compose에 PostGIS 없음 | 🟡 위치 기반 기능에 영향 |
| 마이그레이션 도구 미선정 | golang-migrate, goose, atlas 중 선정 필요 | 🔴 백엔드 구현 차단 |
| 감사 추적 테이블 없음 | IEC 62304 요구사항: 모든 PHI 접근 감사 로그 10년 보존 | 🔴 규정 준수 차단 |
| 데이터 암호화 컬럼 없음 | PHI 필드(측정값, 건강 기록) 컬럼 레벨 암호화 설계 없음 | 🔴 보안 차단 |

### 2.6 보안/규정 갭

| 산출물 | 요구 (스펙) | 상태 | 차단 여부 |
|--------|-----------|------|---------|
| 국가별 규제 준수 체크리스트 | medical-compliance-spec.md | ❌ 미작성 | 인허가 일정 영향 |
| 데이터 보호 정책 초안 | medical-compliance-spec.md | ❌ 미작성 | GDPR/HIPAA 준수 차단 |
| 소프트웨어 안전 등급 판정 | medical-compliance-spec.md | ❌ 미작성 | IEC 62304 프로세스 결정 |
| 위험관리 파일 목차 | medical-compliance-spec.md | ❌ 미작성 | ISO 14971 차단 |
| 사이버보안 요구사항 문서 | medical-compliance-spec.md | ❌ 미작성 | FDA Cybersecurity 차단 |
| 보안 아키텍처 다이어그램 | security-architecture-spec.md | ❌ 미작성 | 설계 검증 불가 |
| STRIDE 위협 모델링 | security-architecture-spec.md | ❌ 미작성 | IEC 81001-5-1 차단 |
| 암호화 정책 문서 | security-architecture-spec.md | ❌ 미작성 | 키 관리 체계 부재 |
| 접근제어 매트릭스 | security-architecture-spec.md | ❌ 미작성 | RBAC 구현 가이드 부재 |
| 침해사고 대응 계획 | security-architecture-spec.md | ❌ 미작성 | 규제 보고 불가 |

### 2.7 테스트 갭

| 영역 | 목표 (TDD 원칙) | 현재 | 갭 |
|------|----------------|------|-----|
| Rust 유닛 테스트 | 80%+ 커버리지 | 19개 테스트 (3개 모듈 0개) | 🔴 crypto/dsp/sync 테스트 0 |
| Go 유닛 테스트 | 80%+ 커버리지 | 0개 | 🔴 전무 |
| Flutter 테스트 | Widget + Integration | 0개 | 🔴 전무 |
| E2E 테스트 | 핵심 플로우 | 1개 스킵, 2개 (헬스체크+차동측정) | 🟡 구조만 존재 |
| 벤치마크 | 성능 기준선 | Cargo.toml에 정의, 실제 코드 미확인 | 🟡 |

---

## 3. 아키텍처 결정 검증

### 3.1 기술 스택 일관성 문제

| 항목 | 사용자 규칙 | 실제 프로젝트 | 판단 |
|------|-----------|-------------|------|
| 백엔드 | Python FastAPI, Pydantic v2 | Go + gRPC + Gin | ⚠️ **불일치** |
| DB | PostgreSQL + PostGIS | PostgreSQL (PostGIS 없음) | ⚠️ **불일치** |
| 프론트엔드 | Next.js 14 + TypeScript + Tailwind | Flutter 주력 + Next.js 보조 | 🟡 부분 일치 |
| AI/Math | PyTorch, NumPy, SciPy | TFLite (Rust), 서버 AI 미정 | 🟡 확장 예정 |

**분석**: 사용자 규칙의 기술 스택과 실제 프로젝트 기술 스택 간에 불일치가 존재합니다.
- 백엔드가 Python FastAPI가 아닌 Go gRPC로 구현됨 — 이는 의도적 결정으로 보이나 사용자 규칙 업데이트 필요
- PostGIS가 Docker Compose에 누락됨 — 위치 기반 기능 필요 시 추가 필요
- 사용자 규칙에 "Multi-tenant 구조, tenant_id 필수"가 있으나 현재 스키마에 미반영

### 3.2 의료기기 규정 관점 아키텍처 검증

| 요구사항 | 현재 아키텍처 | 준수 여부 | 조치 |
|---------|-------------|---------|------|
| IEC 62304 소프트웨어 수명주기 | 체계적 문서화 미시작 | ❌ | 즉시 시작 필요 |
| ISO 14971 위험관리 | 위험관리 파일 없음 | ❌ | 즉시 시작 필요 |
| 데이터 무결성 (21 CFR Part 11) | SHA-256 해시체인 설계됨 | 🟡 부분 | 구현 검증 필요 |
| 감사 추적 (Audit Trail) | 설계에 포함, 구현 없음 | ❌ | DB + 서비스 구현 필요 |
| 데이터 암호화 | AES-256-GCM 설계, 미구현 | ❌ | crypto 모듈 구현 필수 |
| 접근제어 | Keycloak + RBAC 설계됨 | 🟡 부분 | Go 인터셉터 구현 필요 |
| 변경 관리 | Git 사용 | 🟡 부분 | 정형화된 프로세스 필요 |

---

## 4. 리스크 매트릭스

### 4.1 Critical (즉시 조치 필요)

| # | 리스크 | 영향 | 발생 가능성 | 완화 방안 |
|---|--------|------|-----------|---------|
| R1 | AES-256-GCM 암호화 미구현 상태에서 PHI 처리 | 규정 위반, 인허가 불가 | 확정 | crypto 모듈 즉시 구현 |
| R2 | IEC 62304 문서화 미시작 | 인허가 일정 지연 6개월+ | 높음 | 소프트웨어 안전 등급 판정 먼저 |
| R3 | Go 서비스 비즈니스 로직 전무 | MVP 일정 차질 | 확정 | ChatGPT에 즉시 구현 요청 |

### 4.2 High (2주 내 조치 필요)

| # | 리스크 | 영향 | 발생 가능성 | 완화 방안 |
|---|--------|------|-----------|---------|
| R4 | Flutter 앱 빌드 불가 (누락 파일) | 프론트엔드 개발 차단 | 확정 | router/theme 파일 즉시 생성 |
| R5 | DB 마이그레이션 도구 미선정 | 백엔드 DB 연동 차단 | 높음 | golang-migrate 선정 권고 |
| R6 | tenant_id 미포함 스키마 | 멀티테넌시 전면 재설계 | 중간 | 지금 결정하면 비용 최소 |
| R7 | implementation_plan.md 부재 | 로드맵/예산 근거 유실 | 확정 | Antigravity에 확인/복구 요청 |

### 4.3 Medium (Phase 1 내 조치)

| # | 리스크 | 영향 | 발생 가능성 | 완화 방안 |
|---|--------|------|-----------|---------|
| R8 | DSP 모듈 스텁 | 전자코/전자혀 분석 불가 | 중간 | Phase 1 후반 구현 |
| R9 | 테스트 커버리지 80% 미달 | TDD 원칙 위반, 품질 저하 | 확정 | 테스트 병행 작성 |
| R10 | CI/CD 파이프라인 미구현 | 자동 배포/검증 불가 | 높음 | GitHub Actions 설정 |

---

## 5. 다음 단계 우선순위 (권고)

### Phase 1 즉시 실행 항목 (이번 세션)

**Claude 담당 (현재 세션에서 실행):**

| 순서 | 산출물 | 근거 | 차단 해소 |
|------|--------|------|---------|
| 1 | **소프트웨어 안전 등급 판정** | IEC 62304의 기초, 모든 규정 문서의 전제 | R2 |
| 2 | **의료기기 규제 준수 체크리스트 (5개국)** | 인허가 로드맵 결정의 근거 | R2 |
| 3 | **STRIDE 위협 모델링** | 보안 아키텍처의 기반, 코드 구현 방향 결정 | R1 |
| 4 | **데이터 보호 정책 초안** | HIPAA/GDPR/PIPA 동시 준수 체계 | R1 |

**Antigravity 요청 사항:**

| 순서 | 항목 | 근거 |
|------|------|------|
| 1 | `implementation_plan.md` 복구/재작성 | R7 — 로드맵/예산 근거 유실 |
| 2 | `tenant_id` 포함 여부 아키텍처 결정 | R6 — 스키마 설계 전 결정 필수 |
| 3 | crypto 모듈 AES-256-GCM 구현 | R1 — 의료 데이터 보호 필수 |
| 4 | Proto → Go 코드 생성 파이프라인 | R3 — 백엔드 구현 전제 |

**ChatGPT 요청 사항:**

| 순서 | 항목 | 근거 |
|------|------|------|
| 1 | Flutter `app_router.dart` + `app_theme.dart` 생성 | R4 — 빌드 차단 해소 |
| 2 | Go auth-service 비즈니스 로직 구현 | R3 — 핵심 인프라 |
| 3 | SQL 마이그레이션 파일 생성 | R5 — DB 연동 전제 |
| 4 | Flutter 홈/측정 화면 구현 | MVP 핵심 기능 |

---

## 6. 기획안 품질 평가

### 6.1 잘된 점

1. **기술 선택의 적절성**: Rust 코어 + Go MSA + Flutter 조합은 의료기기 성능/안정성 요구에 적합
2. **프로토콜 설계의 완성도**: gRPC Proto, BLE GATT UUID, NFC 태그 구조가 상세하게 정의됨
3. **인프라 설계의 완성도**: Docker Compose 15+ 서비스로 개발 환경이 완전히 구성됨
4. **카트리지 시스템 설계**: 29종 카트리지 체계가 확장 가능하게 설계됨
5. **AI 에이전트 팀 구조**: 역할 분담과 규칙 파일이 체계적으로 구성됨

### 6.2 개선 필요 사항

1. **의료기기 규정 프로세스 부재**: 가장 큰 갭. IEC 62304, ISO 14971 문서화가 선행되어야 함
2. **보안 설계와 구현 간 갭**: AES-256-GCM이 아키텍처에 명시되어 있으나 구현은 빈 스텁
3. **멀티테넌시 결정 미완**: 사용자 규칙과 실제 스키마 간 불일치 해소 필요
4. **테스트 전략 실행 부족**: TDD 원칙이 규칙에 있으나 실제 적용률 낮음
5. **누락된 계획 문서 복구 필요**: implementation_plan.md, ml-model-design-spec.md 등

### 6.3 종합 점수

| 평가 항목 | 점수 (10점) | 코멘트 |
|---------|-----------|--------|
| 기술 아키텍처 설계 | 9/10 | 계층별 기술 선택 우수 |
| 코어 엔진 구현 | 8/10 | 핵심 알고리즘 완성, 스텁 모듈 잔존 |
| 인프라/DevOps 설계 | 8/10 | Docker 완성, K8s/CI-CD 구현 대기 |
| 백엔드 서비스 구현 | 2/10 | 스텁만 존재, 비즈니스 로직 전무 |
| 프론트엔드 구현 | 1/10 | 진입점만 존재, 빌드 불가 |
| 규정/컴플라이언스 | 4/10 | 5종 산출물 완성 (안전등급+체크리스트+STRIDE+데이터보호+검증보고서), 위험관리/V&V/임상 미착수 |
| 보안 구현 | 3/10 | STRIDE+암호화정책+RBAC+IRP 설계 완료, 코드 구현은 여전히 미흡 |
| 테스트/품질 | 3/10 | TDD 원칙 있으나 실행 부족 |
| 문서화 | 6/10 | 공유 컨텍스트 우수, 규정 문서 부재 |
| **종합** | **4.8/10** | **기획 우수, 규정/보안 분석 진전, 구현 가속 필요** |

---

## 7. 결론

만파식 프로젝트의 기획과 아키텍처 설계는 전반적으로 **우수한 수준**입니다. 특히 Rust 코어 엔진의 차동측정 알고리즘, 핑거프린트 벡터 시스템, 그리고 29종 카트리지 체계는 기술적 혁신성이 높습니다.

그러나 **의료기기 인허가에 필수적인 규정 문서가 전무**하고, **Go 백엔드와 Flutter 프론트엔드의 구현이 거의 시작되지 않은 상태**로, Phase 1 MVP 일정(Month 1-4)에 대한 리스크가 있습니다.

**가장 시급한 조치**는:
1. IEC 62304 소프트웨어 안전 등급 판정 (이후 모든 개발/문서화 프로세스 결정)
2. AES-256-GCM 암호화 구현 (PHI 데이터 처리의 전제조건)
3. Go 서비스 비즈니스 로직 구현 시작 (MVP 핵심 기능)

이 보고서의 권고사항에 따라 Claude는 즉시 의료 규정 및 보안 산출물 작성을 시작합니다.

---

**Document Version**: 1.0.0
**작성일**: 2026-02-09
**작성자**: Claude (Security & Architecture Agent)
