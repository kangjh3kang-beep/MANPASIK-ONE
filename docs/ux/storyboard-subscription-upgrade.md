# 구독 및 업그레이드 사용자 여정 스토리보드

**문서번호**: MPK-UX-SB-SUB-v1.0
**기준**: 사이트맵 v1.1 (/market/subscription)
**Phase**: Phase 2
**최종 갱신**: 2026-02-15

---

## 장면 1: 현재 구독 상태

### 와이어프레임
```
┌─────────────────────────────┐
│  ◀  구독 관리                │
├─────────────────────────────┤
│                             │
│ 현재 구독 플랜               │
│ ┌─────────────────────────┐ │
│ │ ┌───────────────────┐   │ │
│ │ │  ⭐ Basic          │   │ │
│ │ │  월 ₩9,900        │   │ │
│ │ └───────────────────┘   │ │
│ │                         │ │
│ │ 상태: ✅ 활성            │ │
│ │ 결제일: 매월 15일         │ │
│ │ 다음 결제: 2026-03-15   │ │
│ │ 결제 수단: 토스페이       │ │
│ └─────────────────────────┘ │
│                             │
│ 내 구독 혜택                 │
│ ┌─────────────────────────┐ │
│ │ ✅ 무제한 측정            │ │
│ │ ✅ 리더기 2대 연결        │ │
│ │ ✅ AI 기본 코칭           │ │
│ │ ❌ 가족 공유 (Pro 이상)   │ │
│ │ ❌ 비대면 진료 (Pro 이상) │ │
│ │ ❌ FHIR 내보내기 (Pro)    │ │
│ └─────────────────────────┘ │
│                             │
│ 💡 Pro로 업그레이드하면       │
│    가족 공유와 비대면 진료를  │
│    이용할 수 있습니다!        │
│                             │
│ [  플랜 변경하기  ]           │
│ [  결제 수단 변경  ]          │
├─────────────────────────────┤
│  🏠   📊   ⬡   🛒   ⚙️   │
└─────────────────────────────┘
```

### 설명
- **현재 티어 카드**: 사용자의 현재 구독 등급(Free/Basic/Pro/Clinical)을 카드 형태로 표시한다.
- **활성 상태/만료일**: 구독 상태, 다음 결제일, 결제 수단 정보를 표시한다.
- **구독 혜택 요약**: 현재 티어에서 사용 가능한 기능(✅)과 상위 티어에서만 가능한 기능(❌)을 구분한다.
- **업그레이드 유도**: 사용하지 못하는 기능을 강조하며 상위 플랜으로 유도한다.

### UX 포인트
- 혜택 목록에서 잠긴 기능 탭 시 해당 기능 설명 + "업그레이드" 버튼 노출
- 결제 수단 변경: Toss SDK 카드 관리 화면 호출
- Free 사용자: "현재 무료 플랜입니다. 더 많은 기능을 사용해보세요!" 표시

### 접근성
- 구독 상태: 스크린리더 "현재 Basic 플랜, 활성 상태, 다음 결제일 2026년 3월 15일"
- 혜택 목록: "무제한 측정, 사용 가능" / "가족 공유, Pro 이상 필요, 사용 불가"
- 최소 터치 영역 48x48dp

### 음성 안내 (TTS)
> "구독 관리입니다. 현재 Basic 플랜을 이용 중입니다. 플랜 변경이나 결제 수단 변경을 할 수 있습니다."

---

## 장면 2: 4개 플랜 비교표

### 와이어프레임
```
┌─────────────────────────────┐
│  ◀  플랜 선택                │
├─────────────────────────────┤
│                             │
│ ◀ 스와이프하여 플랜 비교 ▶    │
│                             │
│ ┌──────┐┌──────┐┌──────┐   │
│ │ Free ││Basic ││ Pro  │   │
│ │      ││      ││ 추천 │   │
│ │ ₩0   ││₩9,900││₩29,900  │
│ │      ││ /월  ││ /월  │   │
│ ├──────┤├──────┤├──────┤   │
│ │측정   ││측정  ││측정  │   │
│ │1회/일 ││무제한││무제한│   │
│ ├──────┤├──────┤├──────┤   │
│ │리더기 ││리더기││리더기│   │
│ │ 1대  ││ 2대  ││ 5대  │   │
│ ├──────┤├──────┤├──────┤   │
│ │AI코칭 ││AI코칭││AI코칭│   │
│ │  ❌   ││ 기본 ││ 고급 │   │
│ ├──────┤├──────┤├──────┤   │
│ │가족   ││가족  ││가족  │   │
│ │  ❌   ││  ❌  ││ 5명  │   │
│ ├──────┤├──────┤├──────┤   │
│ │비대면 ││비대면││비대면│   │
│ │  ❌   ││  ❌  ││  ✅  │   │
│ ├──────┤├──────┤├──────┤   │
│ │FHIR  ││FHIR ││FHIR │   │
│ │  ❌   ││  ❌  ││  ✅  │   │
│ ├──────┤├──────┤├──────┤   │
│ │[현재] ││[선택]││[선택]│   │
│ └──────┘└──────┘└──────┘   │
│                             │
│    ※ Clinical ₩99,000/월    │
│    리더기 10대, 의료기관급    │
│    분석, MFA, 전용 지원      │
│    [Clinical 상세 보기]      │
│                             │
├─────────────────────────────┤
│ 💰 Pro 추천 이유              │
│ ┌─────────────────────────┐ │
│ │ • 가족 5명까지 공유 가능  │ │
│ │ • 비대면 진료 연동        │ │
│ │ • FHIR 의료 데이터 내보내기│ │
│ │ • 고급 AI 분석 및 예측    │ │
│ │ • 연간 결제 시 20% 할인   │ │
│ └─────────────────────────┘ │
└─────────────────────────────┘
```

### 설명
- **4개 플랜**: Free(₩0), Basic(₩9,900), Pro(₩29,900, 추천), Clinical(₩99,000)을 비교표 형태로 표시한다.
- **추천 플랜 하이라이트**: Pro 플랜에 "추천" 뱃지와 강조 테두리를 적용한다.
- **기능 비교**: 측정 횟수, 리더기 대수, AI 코칭, 가족 공유, 비대면 진료, FHIR 내보내기 항목을 행으로 비교한다.
- **Clinical 간략 표시**: 화면 하단에 Clinical 플랜 요약을 간략히 표시하고 상세 보기 링크를 제공한다.

### UX 포인트
- 좌우 스와이프로 플랜 카드 탐색 (모바일 환경)
- 현재 플랜에 "현재" 뱃지 표시
- 추천 플랜(Pro): 골드 테두리 + 상단 리본 뱃지
- 연간 결제 토글: 월간/연간 전환 시 가격 즉시 재계산 (연간 20% 할인)
- Clinical: 기업/의료기관용으로 별도 상담 신청 CTA 제공

### 접근성
- 비교표: 스크린리더에서 "Free 플랜, 측정 1일 1회, 리더기 1대, AI 코칭 미포함..."
- 추천 뱃지: "Pro 플랜, 추천, 월 29,900원"
- 현재 플랜 표시: "Free 플랜, 현재 이용 중"

### 음성 안내 (TTS)
> "플랜 선택 화면입니다. Free, Basic, Pro, Clinical 4개 플랜을 비교할 수 있습니다. Pro 플랜이 추천됩니다."

---

## 장면 3: 업그레이드 결제

### 와이어프레임
```
┌─────────────────────────────┐
│  ◀  구독 업그레이드           │
├─────────────────────────────┤
│                             │
│ 선택한 플랜                  │
│ ┌─────────────────────────┐ │
│ │ ⭐ Pro 플랜 (추천)        │ │
│ │ 월 ₩29,900              │ │
│ │ Basic → Pro 업그레이드    │ │
│ └─────────────────────────┘ │
│                             │
│ 결제 주기                    │
│ ┌─────────────────────────┐ │
│ │ ○ 월간 결제  ₩29,900/월  │ │
│ │ ● 연간 결제  ₩287,040/년 │ │
│ │   (₩23,920/월, 20% 절약) │ │
│ └─────────────────────────┘ │
│                             │
│ 프로모션 쿠폰                │
│ ┌─────────────────────────┐ │
│ │ [쿠폰 코드 입력     ] ✅  │ │
│ │ 🎉 WELCOME30 적용됨      │ │
│ │    첫 달 30% 할인         │ │
│ └─────────────────────────┘ │
│                             │
│ 결제 수단 선택               │
│ ○ 토스페이                   │
│ ● 신용/체크카드 (기존 등록)   │
│   **** **** **** 1234       │
│ ○ 계좌이체                   │
│ ○ 새 카드 등록               │
│                             │
│ ┌─────────────────────────┐ │
│ │ 결제 요약                 │ │
│ │ Pro 연간 결제  ₩287,040  │ │
│ │ 쿠폰 할인     -₩7,176    │ │
│ │ ─────────────────────── │ │
│ │ 결제 금액     ₩279,864   │ │
│ │ (월 ₩23,322 상당)        │ │
│ └─────────────────────────┘ │
│                             │
│ ☑ 정기 결제 동의             │
│ ☑ 구독 약관에 동의합니다      │
│                             │
│ [   ₩279,864 결제하기   ]   │
│                             │
│ 💡 업그레이드 즉시 반영!      │
│    새 기능을 바로 사용하세요.  │
└─────────────────────────────┘
```

### 설명
- **플랜 선택 확인**: 이전 화면에서 선택한 플랜과 현재 플랜 대비 변경 사항을 표시한다.
- **결제 주기**: 월간/연간 결제를 라디오 버튼으로 선택하며, 연간 결제 시 할인율을 명시한다.
- **프로모션 쿠폰**: 쿠폰 코드를 입력하면 즉시 유효성 검증 후 할인을 적용한다.
- **결제 수단**: 기존 등록된 결제 수단 또는 새 카드 등록을 선택한다.
- **결제 요약**: 최종 결제 금액을 요약하고 월 환산 금액을 표시한다.
- **업그레이드 즉시 반영**: 결제 완료 시 새 플랜의 기능이 즉시 활성화된다.

### UX 포인트
- 쿠폰 입력: 실시간 유효성 검증 (디바운스 500ms), 유효 시 초록색 체크 + 할인 금액 표시
- 결제 실패 시: "결제에 실패했습니다. 다른 결제 수단을 선택해주세요." + 재시도
- 결제 성공 후: 축하 애니메이션 + 새 기능 투어 안내
- PaymentService.CreateSubscription RPC 호출

### 접근성
- 결제 금액: 스크린리더 "결제 금액 279,864원, 월 23,322원 상당"
- 결제 버튼: "279,864원 결제하기 버튼"
- 쿠폰 적용: "쿠폰 WELCOME30 적용됨, 첫 달 30퍼센트 할인"

### 음성 안내 (TTS)
> "구독 업그레이드 결제 화면입니다. Pro 연간 결제 279,864원입니다. 결제를 진행하시겠습니까?"

---

## 장면 4: 다운그레이드 및 해지

### 와이어프레임
```
┌─────────────────────────────┐
│  ◀  구독 변경                │
├─────────────────────────────┤
│                             │
│ ⚠️ 다운그레이드 안내          │
│                             │
│ Pro → Basic 변경 시          │
│ 다음 기능을 잃게 됩니다:      │
│                             │
│ ┌─────────────────────────┐ │
│ │ ❌ 가족 공유 (5명)        │ │
│ │   → 가족 멤버 데이터 접근  │ │
│ │     불가 (데이터는 보존)   │ │
│ │ ❌ 비대면 진료 연동        │ │
│ │   → 예약된 진료 유지,     │ │
│ │     신규 예약 불가         │ │
│ │ ❌ FHIR 데이터 내보내기    │ │
│ │ ❌ 고급 AI 분석            │ │
│ │ ❌ 리더기 5→2대 제한       │ │
│ │   → 초과 리더기 연결 해제  │ │
│ └─────────────────────────┘ │
│                             │
│ [다운그레이드 확인] [취소]    │
│                             │
├═════════════════════════════┤
│                             │
│ 🛑 구독 해지                 │
│                             │
│ 해지 사유를 선택해주세요       │
│ ┌─────────────────────────┐ │
│ │ ○ 비용이 부담됩니다       │ │
│ │ ○ 사용 빈도가 낮습니다    │ │
│ │ ○ 필요한 기능이 없습니다  │ │
│ │ ○ 다른 서비스를 이용합니다│ │
│ │ ○ 기타: [____________]   │ │
│ └─────────────────────────┘ │
│                             │
│ 해지 시 안내                 │
│ ┌─────────────────────────┐ │
│ │ 📅 잔여 기간: 28일        │ │
│ │ 잔여 기간 동안 현재 플랜   │ │
│ │ 혜택이 유지됩니다.         │ │
│ │                         │ │
│ │ ⚠️ 해지 후에도 측정 데이터 │ │
│ │ 는 90일간 보존됩니다.     │ │
│ │ Free 플랜으로 전환됩니다.  │ │
│ └─────────────────────────┘ │
│                             │
│ [  구독 해지  ]              │
│                             │
│ 💡 혹시 비용이 부담이시라면?  │
│    Basic 플랜(₩9,900)으로   │
│    다운그레이드를 추천합니다!  │
│    [Basic으로 변경]           │
└─────────────────────────────┘
```

### 최종 확인 다이얼로그
```
┌─────────────────────────────┐
│                             │
│    정말 구독을 해지하시겠습니까?│
│                             │
│    해지 후 Free 플랜으로      │
│    전환됩니다.                │
│    잔여 기간(28일) 동안       │
│    현재 혜택이 유지됩니다.    │
│                             │
│   [해지 확인]  [계속 이용]    │
│                             │
└─────────────────────────────┘
```

### 설명
- **다운그레이드 경고**: 하위 플랜 변경 시 잃게 되는 기능 목록을 명확히 표시한다.
- **해지 사유 선택**: 해지 전 사유를 필수로 선택하도록 하여 이탈 원인을 분석한다.
- **잔여 기간 안내**: 해지 시 남은 기간 동안 현재 플랜 혜택이 유지됨을 안내한다.
- **데이터 보존 안내**: 해지 후에도 측정 데이터가 90일간 보존됨을 명시한다.
- **리텐션 전략**: 해지 사유에 따른 대안 플랜 추천으로 이탈을 방지한다.

### UX 포인트
- 다운그레이드 확인: 2단계 확인 (목록 확인 → 최종 확인 다이얼로그)
- 해지 확인: 최종 확인 다이얼로그에서 "해지 확인" 버튼은 빨간색, "계속 이용"은 브랜드 색상
- 해지 완료 시: "구독이 해지되었습니다. 잔여 기간 동안 현재 혜택을 이용하실 수 있습니다."
- PaymentService.CancelSubscription / PaymentService.DowngradeSubscription RPC 호출
- 해지 사유 데이터: 관리자 포탈에서 분석용으로 수집

### 접근성
- 잃게 되는 기능: 스크린리더 "가족 공유 5명, 비대면 진료, FHIR 내보내기 기능을 잃게 됩니다"
- 해지 사유: 라디오 버튼 접근성 라벨 제공
- 최종 확인 다이얼로그: 모달 포커스 트랩 적용

### 음성 안내 (TTS)
> "구독 변경 화면입니다. 다운그레이드 또는 해지를 진행할 수 있습니다. 변경 전 안내 사항을 확인해주세요."

---

## 네비게이션 흐름

```
┌──────────┐      ┌──────────────┐
│ 설정     │─────▶│ 구독 관리    │
│ /settings│      │ /market/     │
└──────────┘      │ subscription │
                  └──────┬───────┘
┌──────────┐             │
│ 마켓     │─────▶       │
│ /market  │             │
└──────────┘      ┌──────┴───────┐
                  │              │
            ┌─────▼──────┐ ┌────▼──────┐
            │ 플랜 비교표 │ │ 결제 수단 │
            │ 선택       │ │ 변경      │
            └─────┬──────┘ └───────────┘
                  │
            ┌─────▼──────┐
            │ 업그레이드  │
            │ 결제       │
            └─────┬──────┘
                  │
            ┌─────▼──────┐
            │ 결제 완료   │
            └────────────┘

┌──────────────┐      ┌──────────────┐
│ 구독 관리    │─────▶│ 다운그레이드  │
│              │      │ / 해지       │
└──────────────┘      └──────────────┘
```

- **Settings → Subscription**: 설정 > 구독 관리 메뉴 진입
- **Market → Subscription**: 마켓 > 정기 구독 서비스 탭 진입
- **Subscription → Payment**: 플랜 선택 → 결제 화면
- **Subscription → Downgrade/Cancel**: 구독 관리 하단 "플랜 변경" → 다운그레이드/해지

---

## 기술 참조

- `frontend/flutter-app/lib/features/market/` 마켓/구독 화면 구현
- `backend/shared/proto/manpasik.proto` PaymentService, ShopService
- 결제 연동: Toss Payments SDK (정기 결제)
- 구독 상태 관리: 서버 사이드 구독 스케줄러 (만료/갱신/다운그레이드)
- 쿠폰 시스템: PaymentService.ValidateCoupon RPC

---

## 접근성 종합

- 비교표: 스크린리더에서 행/열 구조로 읽기 가능하도록 테이블 시맨틱 적용
- 가격 정보: "월 29,900원" 명확하게 읽기
- 결제 버튼: 최소 56x56dp, 고대비 색상
- 해지 확인 모달: 포커스 트랩 + ESC 키 취소 지원
- 다운그레이드 경고: 빨간색 아이콘 + 텍스트 병용 (색각 이상 대응)
