# 데이터 허브 사용자 여정 스토리보드

**문서번호**: MPK-UX-SB-DATA-v1.0
**기준**: 사이트맵 v1.1 (/data)
**Phase**: Phase 2
**최종 갱신**: 2026-02-15

---

## 장면 1: 건강 타임라인

### 와이어프레임
```
┌─────────────────────────────┐
│  ◀  데이터 허브     📤  ⚙️  │
├─────────────────────────────┤
│ [7일] [30일] [90일] [사용자]  │
├─────────────────────────────┤
│ 📈 건강 트렌드                │
│ ┌─────────────────────────┐ │
│ │ 혈당 (mg/dL)             │ │
│ │ 160┤                     │ │
│ │ 140┤    ╱╲               │ │
│ │ 120┤  ╱    ╲  ╱╲         │ │
│ │ 100┤╱        ╲╱  ╲  ╱─   │ │
│ │  80┤               ╲╱    │ │
│ │    └──────────────────── │ │
│ │    월  화  수  목  금  토  일│ │
│ │                         │ │
│ │ ░░░░░ My Zone (80-120)  │ │
│ │ ─── 평균선 108 mg/dL    │ │
│ └─────────────────────────┘ │
│                             │
│ 바이오마커 상세               │
│ ┌─────────────────────────┐ │
│ │ 🩸 공복혈당  98 mg/dL ✅  │ │
│ │    7일 평균: 102 | 추세: ↓│ │
│ ├─────────────────────────┤ │
│ │ 🫀 총콜레스테롤 195 mg/dL │ │
│ │    7일 평균: 198 | 추세: ↓│ │
│ ├─────────────────────────┤ │
│ │ 🧬 중성지방  120 mg/dL   │ │
│ │    7일 평균: 125 | 추세: ─│ │
│ ├─────────────────────────┤ │
│ │ 💤 수면 점수  78/100      │ │
│ │    7일 평균: 75 | 추세: ↑ │ │
│ └─────────────────────────┘ │
├─────────────────────────────┤
│  🏠   📊   ⬡   🛒   ⚙️   │
└─────────────────────────────┘
```

### 설명
- **기간 선택 칩**: 7일/30일/90일 또는 사용자 지정 기간을 칩 버튼으로 선택한다.
- **트렌드 라인 차트**: fl_chart 라이브러리로 구현한 인터랙티브 라인 차트를 표시한다. 터치 시 해당 시점의 상세 수치를 툴팁으로 표시한다.
- **My Zone 오버레이**: 사용자의 개인 기준선(정상 범위)을 반투명 배경으로 차트 위에 오버레이한다.
- **바이오마커 상세 리스트**: 각 측정 항목별 최신 수치, 기간 평균, 추세(상승/하락/안정) 화살표를 표시한다.

### UX 포인트
- 차트 핀치 줌: 시간 축 확대/축소로 상세 데이터 탐색
- 바이오마커 탭 시 해당 항목 상세 히스토리 화면으로 전환
- My Zone 기준선은 설정에서 사용자가 직접 조정 가능
- HealthRecordService.GetTimeline RPC로 데이터 조회 (페이지네이션)

### 접근성
- 차트 데이터: 스크린리더 "혈당 트렌드, 월요일 105, 화요일 132, 수요일 145..." 순차 읽기
- 기간 칩 선택 상태: "7일 선택됨" 접근성 라벨
- 추세 화살표: 색상 + 아이콘 + 텍스트("상승", "하락", "안정") 병용
- 최소 터치 영역 48x48dp

### 음성 안내 (TTS)
> "데이터 허브입니다. 기간을 선택하여 건강 트렌드를 확인하세요. 현재 7일간 데이터를 표시 중입니다."

---

## 장면 2: 데이터 내보내기

### 와이어프레임
```
┌─────────────────────────────┐
│  데이터 내보내기              │
├─────────────────────────────┤
│                             │
│ 내보내기 형식을 선택하세요     │
│                             │
│ ┌─────────────────────────┐ │
│ │ 📄 PDF 리포트             │ │
│ │ 건강 요약 리포트 (시각화)  │ │
│ │ 의료기관 제출용, 가족 공유  │ │
│ │               [내보내기]  │ │
│ ├─────────────────────────┤ │
│ │ 📊 CSV 데이터             │ │
│ │ 원시 데이터 (스프레드시트)  │ │
│ │ 연구·분석 목적             │ │
│ │               [내보내기]  │ │
│ ├─────────────────────────┤ │
│ │ 🏥 FHIR R4 (의료기관)     │ │
│ │ HL7 FHIR R4 표준 형식     │ │
│ │ 의료기관 EMR 연동용        │ │
│ │ ⚠️ Pro 이상 구독 필요      │ │
│ │               [내보내기]  │ │
│ └─────────────────────────┘ │
│                             │
│ 내보내기 범위                │
│ 📅 2026-01-15 ~ 2026-02-15 │
│ [기간 변경]                  │
│                             │
│ 포함 항목                    │
│ ☑ 혈당 측정 데이터           │
│ ☑ 지질 패널                 │
│ ☑ AI 분석 요약              │
│ ☐ 운동 기록                 │
│ ☐ 식단 기록                 │
│                             │
├─────────────────────────────┤
│ ⏳ PDF 생성 중... 75%        │
│ [████████████████░░░░] 75%  │
│                             │
│ ✅ 다운로드 완료!             │
│ [파일 열기] [공유하기]        │
└─────────────────────────────┘
```

### 설명
- **내보내기 팝업 메뉴**: 데이터 허브 상단 📤 아이콘 탭 시 바텀시트로 내보내기 옵션을 표시한다.
- **PDF 리포트**: 시각화된 건강 요약 리포트를 PDF로 생성한다.
- **CSV 데이터**: 원시 측정 데이터를 스프레드시트 형식으로 내보낸다.
- **FHIR R4 형식**: HL7 FHIR R4 표준 JSON으로 내보내어 의료기관 EMR과 연동한다. Pro 이상 구독에서 사용 가능하다.
- **다운로드 진행 상태**: 파일 생성 및 다운로드 과정을 프로그레스 바로 표시한다.

### UX 포인트
- FHIR 내보내기: 구독 등급 미달 시 "Pro 이상 구독 필요" 잠금 표시 + 업그레이드 유도
- 내보내기 완료 후: 시스템 공유 시트(Share Sheet)로 메일/클라우드/메시지 전송 가능
- 오프라인 대응: 내보내기 요청을 큐에 저장, 온라인 복귀 시 자동 처리

### 접근성
- 내보내기 형식: 스크린리더 "PDF 리포트, 건강 요약 리포트"
- 진행 상태: "PDF 생성 중 75퍼센트"
- 구독 잠금: "FHIR 내보내기, Pro 이상 구독 필요, 현재 사용 불가"

### 음성 안내 (TTS)
> "데이터 내보내기입니다. PDF, CSV, FHIR 형식 중 선택하세요."

---

## 장면 3: 외부 연동 설정

### 와이어프레임
```
┌─────────────────────────────┐
│  ◀  외부 연동 설정           │
├─────────────────────────────┤
│                             │
│ 📱 건강 플랫폼 연동           │
│ ┌─────────────────────────┐ │
│ │ 🍎 Apple HealthKit       │ │
│ │ 상태: ✅ 연동됨           │ │
│ │ 마지막 동기화: 10분 전     │ │
│ │                 [해제]   │ │
│ ├─────────────────────────┤ │
│ │ 🤖 Google Health Connect │ │
│ │ 상태: ⬚ 미연동            │ │
│ │                 [연동]   │ │
│ └─────────────────────────┘ │
│                             │
│ 연동 데이터 범위 선택         │
│ ┌─────────────────────────┐ │
│ │ ☑ 걸음수 (Steps)         │ │
│ │ ☑ 심박수 (Heart Rate)    │ │
│ │ ☑ 수면 (Sleep)           │ │
│ │ ☐ 체중 (Weight)          │ │
│ │ ☐ 혈압 (Blood Pressure)  │ │
│ │ ☐ 체온 (Body Temperature)│ │
│ └─────────────────────────┘ │
│                             │
│ 🌍 공공데이터 연계            │
│ ┌─────────────────────────┐ │
│ │ 🌬️ 대기질 (미세먼지)      │ │
│ │ 상태: ✅ 활성             │ │
│ │ 지역: 서울특별시 강남구    │ │
│ │                 [변경]   │ │
│ ├─────────────────────────┤ │
│ │ 💧 수질 정보              │ │
│ │ 상태: ✅ 활성             │ │
│ │ 지역: 서울특별시 강남구    │ │
│ │                 [변경]   │ │
│ └─────────────────────────┘ │
│                             │
│ 📍 지역 설정                 │
│ 현재 위치: 서울특별시 강남구   │
│ [GPS 자동 설정] [수동 변경]   │
│                             │
│ ⚠️ 외부 연동 데이터는 참고용이며│
│ 만파식 측정 데이터와 정확도가  │
│ 다를 수 있습니다.             │
└─────────────────────────────┘
```

### 설명
- **HealthKit / Google Health Connect**: iOS는 HealthKit, Android는 Google Health Connect와 연동하여 걸음수/심박수/수면 등 외부 데이터를 가져온다.
- **연동 데이터 범위**: 체크박스로 가져올 데이터 종류를 세밀하게 제어한다.
- **공공데이터 연계**: 환경부/기상청 공공 API를 통해 대기질(미세먼지)과 수질 정보를 지역 기반으로 연동한다.
- **지역 설정**: GPS 자동 감지 또는 수동 입력으로 공공데이터 조회 지역을 설정한다.

### UX 포인트
- HealthKit 연동 시 시스템 권한 요청 팝업 자동 호출
- 동기화 주기: 백그라운드 15분 간격 자동 동기화
- 연동 해제 시 확인 다이얼로그: "연동을 해제하면 외부 데이터가 더 이상 업데이트되지 않습니다."
- 공공데이터: 1시간 간격 자동 갱신, 캐시 적용

### 접근성
- 토글 스위치: 스크린리더 "Apple HealthKit, 연동됨, 스위치 켜짐"
- 지역 설정: "현재 위치 서울특별시 강남구, GPS 자동 설정 버튼"
- 데이터 범위 체크박스: "걸음수, 선택됨"

### 음성 안내 (TTS)
> "외부 연동 설정입니다. 건강 플랫폼 연동과 공공데이터 연계를 설정할 수 있습니다."

---

## 장면 4: 가족 데이터 관리

### 와이어프레임
```
┌─────────────────────────────┐
│  ◀  가족 데이터     👨‍👩‍👧‍👦  ⚙️│
├─────────────────────────────┤
│ [나] [아버지] [어머니] [딸]   │
├─────────────────────────────┤
│ 👨 아버지 건강 데이터          │
│                             │
│ 📈 비교 차트                  │
│ ┌─────────────────────────┐ │
│ │ 혈당 비교 (최근 30일)     │ │
│ │                         │ │
│ │ 140┤  ╱╲                │ │
│ │ 120┤ ╱  ╲──── 아버지     │ │
│ │ 100┤╱ ─────── 나        │ │
│ │  80┤                    │ │
│ │    └─────────────────── │ │
│ │    ──── 아버지  ─── 나   │ │
│ └─────────────────────────┘ │
│                             │
│ 바이오마커 요약               │
│ ┌─────────────────────────┐ │
│ │ 🩸 혈당    145 mg/dL ⚠️  │ │
│ │ 🫀 콜레스테롤 210 mg/dL ⚠️│ │
│ │ 💤 수면 점수  65/100     │ │
│ └─────────────────────────┘ │
│                             │
│ 공유 권한 관리                │
│ ┌─────────────────────────┐ │
│ │ 데이터 조회 권한: ✅ 허용  │ │
│ │ 알림 수신 권한:  ✅ 허용   │ │
│ │ 긴급 알림 권한:  ✅ 허용   │ │
│ │ AI 분석 공유:    ☐ 미허용  │ │
│ │                 [변경]   │ │
│ └─────────────────────────┘ │
│                             │
│ [📊 상세 리포트] [📤 내보내기]│
├─────────────────────────────┤
│  🏠   📊   ⬡   🛒   ⚙️   │
└─────────────────────────────┘
```

### 설명
- **가족 구성원별 탭**: 상단 탭으로 가족 멤버를 전환하여 각 멤버의 건강 데이터를 조회한다.
- **비교 차트**: 선택한 멤버와 본인의 바이오마커를 동일 차트에 오버레이하여 비교한다.
- **바이오마커 요약**: 해당 멤버의 주요 건강 지표 최신 수치와 상태를 표시한다.
- **공유 권한 관리**: 멤버 간 데이터 조회/알림/긴급 알림/AI 분석 공유 권한을 세밀하게 관리한다.

### UX 포인트
- 비교 차트: 멤버 2명까지 동시 비교, 색상으로 구분 (본인: 파랑, 가족: 주황)
- 권한 변경 시 해당 멤버에게 알림 전송
- FamilyService.GetMemberHealth + HealthRecordService.GetTimeline RPC 호출
- Pro 이상 구독에서 가족 데이터 관리 이용 가능

### 접근성
- 멤버 탭: "아버지 탭, 4개 중 2번째"
- 비교 차트: "혈당 비교, 아버지 평균 130, 나 평균 102"
- 권한 토글: "데이터 조회 권한, 허용됨, 스위치 켜짐"

### 음성 안내 (TTS)
> "가족 데이터 관리입니다. 가족 멤버를 선택하여 건강 데이터를 확인하고 비교할 수 있습니다."

---

## 네비게이션 흐름

```
┌──────────────────┐
│  데이터 허브 메인  │
│  /data            │
│  (탭 내부 전환)    │
├──────────────────┤
│ ┌──────────────┐ │
│ │ 건강 타임라인 │ │──▶ 바이오마커 상세
│ └──────────────┘ │
│ ┌──────────────┐ │    ┌──────────────┐
│ │ 내보내기 📤   │ │──▶│ 내보내기 팝업 │
│ └──────────────┘ │    │ (바텀시트)    │
│ ┌──────────────┐ │    └──────────────┘
│ │ 외부 연동 ⚙️  │ │──▶ 외부 연동 설정
│ └──────────────┘ │
│ ┌──────────────┐ │
│ │ 가족 데이터   │ │──▶ 멤버별 상세
│ └──────────────┘ │
└──────────────────┘
```

- **DataHub(탭 내부) → ExportDialog**: 상단 📤 아이콘 탭 시 내보내기 바텀시트 표시
- **DataHub → ExternalIntegration**: 설정 ⚙️ 아이콘 탭 시 외부 연동 설정 화면 이동
- **DataHub → FamilyData**: 가족 데이터 탭 전환

---

## 기술 참조

- `frontend/flutter-app/lib/features/data_hub/` 데이터 허브 화면 구현
- `backend/shared/proto/manpasik.proto` HealthRecordService, FamilyService
- 차트 라이브러리: fl_chart (Flutter)
- FHIR R4 내보내기: HL7 FHIR R4 Patient/Observation 리소스 생성
- 공공데이터 API: 환경부 에어코리아, 수도정보시스템 OpenAPI

---

## 접근성 종합

- 차트 데이터: 시각 외 텍스트 대안 제공 (스크린리더 순차 읽기)
- 모든 토글/체크박스: 상태 변경 시 즉시 스크린리더 알림
- 색상 대비 WCAG AA 준수 (차트 라인 색상 4.5:1 이상)
- 시니어 모드: 간소화된 타임라인 뷰 (주요 지표 3개만 표시)
- 최소 터치 영역: 모든 인터랙티브 요소 48x48dp
