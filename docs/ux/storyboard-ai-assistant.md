# AI 코치 & 상담 사용자 여정 스토리보드

**문서번호**: MPK-UX-SB-AI-v1.0
**기준**: 사이트맵 v1.1 (/coach, /chat, /coach/food)
**Phase**: Phase 2
**최종 갱신**: 2026-02-15

---

## 장면 1: AI 코치 메인 — 오늘의 건강 인사이트

### 와이어프레임
```
┌─────────────────────────────┐
│  ◀  AI 코치          🔔  ⚙️│
├─────────────────────────────┤
│ 오늘의 건강 인사이트          │
│ ┌─────────────────────────┐ │
│ │ 🤖 AI 분석 요약          │ │
│ │ "공복혈당이 안정적이며,    │ │
│ │  지난주 대비 수면의 질이   │ │
│ │  12% 개선되었습니다."     │ │
│ │                         │ │
│ │ 신뢰도: ██████████ 92%   │ │
│ │ 🛡️ AI 분석 신뢰도 뱃지    │ │
│ │ 기반 데이터: 최근 14일간   │ │
│ └─────────────────────────┘ │
│                             │
│ 건강 관리 카테고리            │
│ ┌──────────┐ ┌──────────┐  │
│ │ 🍎       │ │ 🏃       │  │
│ │ 식이 관리 │ │ 운동 코칭 │  │
│ │ 추천 3건  │ │ 추천 2건  │  │
│ └──────────┘ └──────────┘  │
│ ┌──────────┐ ┌──────────┐  │
│ │ 🌙       │ │ 📈       │  │
│ │ 수면 관리 │ │ 트렌드    │  │
│ │ 분석 완료 │ │ 주간 리포트│  │
│ └──────────┘ └──────────┘  │
│                             │
│         [ 💬 AI 상담 시작 ]  │
├─────────────────────────────┤
│  🏠   📊   ⬡   🛒   ⚙️   │
└─────────────────────────────┘
```

### 설명
- **인사이트 카드**: 최근 14일간 측정 데이터를 기반으로 AI가 생성한 건강 요약을 표시한다.
- **신뢰도 뱃지**: 분석에 사용된 데이터 양과 품질에 따라 신뢰도를 퍼센트로 표시한다.
- **카테고리 그리드**: 식이/운동/수면/트렌드 분석 4개 카테고리로 구분하며, 각 카테고리 탭 시 세부 추천 리스트로 확장된다.
- **AI 상담 버튼**: 채팅 인터페이스(/chat)로 진입하는 주요 CTA 버튼이다.

### UX 포인트
- 카테고리 카드 탭 시 아코디언 확장으로 세부 추천 리스트 3~5개 표시
- 인사이트 카드 새로고침: 풀 투 리프레시 또는 우상단 새로고침 아이콘
- 카테고리별 뱃지 숫자로 미확인 추천 건수 표시

### 접근성
- 신뢰도 바: 스크린리더 "AI 분석 신뢰도 92퍼센트"
- 카테고리 카드: 최소 터치 영역 48x48dp, 아이콘 + 텍스트 라벨 병용
- 고대비 모드에서 카드 테두리 강조

### 음성 안내 (TTS)
> "AI 코치입니다. 오늘의 건강 인사이트를 확인하세요. 카테고리를 선택하면 맞춤 추천을 볼 수 있습니다."

---

## 장면 2: 대화형 AI 상담

### 와이어프레임
```
┌─────────────────────────────┐
│  ◀  AI 상담       📋  🗑️   │
├─────────────────────────────┤
│ ⚠️ AI 상담은 의료 상담을      │
│ 대체하지 않습니다. 증상이      │
│ 심각한 경우 전문의에게         │
│ 문의하세요.                   │
├─────────────────────────────┤
│                             │
│         🤖 만파식 AI          │
│    "안녕하세요! 건강 관련      │
│     질문을 자유롭게           │
│     물어보세요."              │
│                             │
│ ┌─────────────────────────┐ │
│ │ 예시 질문 칩:              │ │
│ │ [혈당 낮추려면?]           │ │
│ │ [오늘 운동 추천해줘]       │ │
│ │ [수면 개선 팁 알려줘]      │ │
│ │ [내 건강 트렌드 분석해줘]   │ │
│ └─────────────────────────┘ │
│                             │
│         👤 사용자             │
│    "혈당 낮추려면             │
│     어떻게 해야 하나요?"      │
│                             │
│         🤖 만파식 AI          │
│    "최근 7일 데이터를          │
│     분석한 결과, 식후 30분    │
│     가벼운 산책이 효과적       │
│     입니다. 귀하의 평균       │
│     식후 혈당은 145mg/dL로    │
│     산책 후 평균 18%          │
│     감소했습니다."            │
│    📊 [데이터 근거 보기]       │
│                             │
├─────────────────────────────┤
│ [  메시지를 입력하세요...  ] 📤│
└─────────────────────────────┘
```

### 설명
- **의학적 면책 배너**: 화면 상단에 고정 배너로 "의료 상담을 대체하지 않습니다" 경고를 표시한다.
- **AI 아바타**: 만파식 브랜드 캐릭터 아이콘으로 AI 응답을 시각적으로 구분한다.
- **예시 질문 칩**: 첫 진입 시 4개의 추천 질문을 칩 형태로 제공하여 대화를 유도한다.
- **건강 데이터 기반 맥락 답변**: AI가 사용자의 실제 측정 데이터를 인용하여 개인화된 답변을 생성한다.
- **데이터 근거 링크**: "데이터 근거 보기" 탭 시 답변에 사용된 측정 데이터 차트를 바텀시트로 표시한다.

### UX 포인트
- 타이핑 인디케이터: AI 응답 생성 중 "..." 애니메이션
- 스트리밍 응답: 글자 단위 점진적 표시 (SSE/gRPC 스트림)
- 대화 히스토리: 이전 대화 세션 조회 가능 (📋 아이콘)
- 대화 삭제: 🗑️ 아이콘으로 현재 세션 초기화

### 접근성
- 채팅 버블: 사용자/AI 구분을 색상 + 위치(좌/우)로 표시
- 메시지 입력 필드: 접근성 라벨 "AI에게 질문 입력"
- 면책 배너: 스크린리더 우선 읽기 (accessibilityFirst)

### 음성 안내 (TTS)
> "AI 상담 화면입니다. 건강 관련 질문을 입력하거나 예시 질문을 선택하세요. 이 서비스는 의료 상담을 대체하지 않습니다."

---

## 장면 3: 음식 사진 칼로리 분석

### 와이어프레임
```
┌─────────────────────────────┐
│  ◀  음식 분석               │
├─────────────────────────────┤
│                             │
│ ┌─────────────────────────┐ │
│ │                         │ │
│ │    [촬영된 음식 사진]     │ │
│ │                         │ │
│ │    📷 / 🖼️              │ │
│ │  카메라   갤러리          │ │
│ └─────────────────────────┘ │
│                             │
│ ⏳ AI 분석 중...             │
│ [████████░░░░░░░░░░] 45%    │
│ "음식을 인식하고 있습니다"     │
│                             │
├─────────────────────────────┤
│ 📊 분석 결과                 │
│ ┌─────────────────────────┐ │
│ │ 인식: 된장찌개 + 밥 + 반찬│ │
│ │                         │ │
│ │ 🔥 칼로리    520 kcal    │ │
│ │ 🍞 탄수화물   68g        │ │
│ │ 🥩 단백질     22g        │ │
│ │ 🧈 지방       15g        │ │
│ │ 🥬 식이섬유    6g        │ │
│ │                         │ │
│ │ [원형 차트: 탄/단/지 비율] │ │
│ └─────────────────────────┘ │
│                             │
│ 🤖 AI 코멘트                 │
│ "균형 잡힌 한식 식사입니다!    │
│  단백질 섭취를 조금 더         │
│  늘리면 좋겠습니다."          │
│                             │
│ [  식단 기록 저장  ]          │
│ [  다시 촬영  ]              │
├─────────────────────────────┤
│  🏠   📊   ⬡   🛒   ⚙️   │
└─────────────────────────────┘
```

### 설명
- **카메라/갤러리 선택**: 화면 진입 시 카메라 촬영 또는 갤러리에서 사진 선택을 제공한다.
- **AI 분석 로딩**: 사진 업로드 후 음식 인식 및 영양소 분석 과정을 프로그레스 바로 표시한다.
- **영양소 카드**: 칼로리, 탄수화물, 단백질, 지방, 식이섬유를 수치와 원형 차트로 시각화한다.
- **AI 코멘트**: 분석 결과에 대한 AI의 맞춤형 평가와 개선 제안을 표시한다.
- **식단 기록 저장**: 분석 결과를 HealthRecordService에 저장하여 데이터 허브에서 조회할 수 있다.

### UX 포인트
- 카메라 프리뷰: 음식 인식 가이드 프레임 오버레이
- 분석 로딩: Lottie 애니메이션 (접시 아이콘 회전)
- 인식 실패 시: "음식을 인식할 수 없습니다. 다시 촬영해주세요." + 수동 입력 옵션
- 영양소 수정: 사용자가 인식 결과를 수동으로 보정 가능

### 접근성
- 카메라 버튼: 접근성 라벨 "음식 사진 촬영"
- 영양소 수치: 스크린리더 "칼로리 520킬로칼로리, 탄수화물 68그램"
- 원형 차트: alt 텍스트 "탄수화물 52%, 단백질 17%, 지방 26%, 식이섬유 5%"

### 음성 안내 (TTS)
> "음식 분석입니다. 카메라로 음식을 촬영하거나 갤러리에서 사진을 선택하세요."

---

## 장면 4: 운동 영상 소모 칼로리 분석 (Phase 2 후반)

### 와이어프레임
```
┌─────────────────────────────┐
│  ◀  운동 분석               │
├─────────────────────────────┤
│                             │
│ ┌─────────────────────────┐ │
│ │                         │ │
│ │    [촬영된 운동 영상]     │ │
│ │    ▶ 00:00 / 01:23      │ │
│ │                         │ │
│ │    🎥 / 🖼️              │ │
│ │  영상 촬영  갤러리 선택   │ │
│ └─────────────────────────┘ │
│                             │
│ ⏳ 운동 분석 중...            │
│ [██████████░░░░░░░] 62%     │
│ "동작을 분석하고 있습니다"     │
│                             │
├─────────────────────────────┤
│ 📊 분석 결과                 │
│ ┌─────────────────────────┐ │
│ │ 감지된 운동: 스쿼트       │ │
│ │ 운동 시간: 1분 23초       │ │
│ │ 반복 횟수: 15회           │ │
│ │                         │ │
│ │ 🔥 소모 칼로리  45 kcal   │ │
│ │ 💓 예상 심박수  ~110 bpm  │ │
│ │ 💪 주요 근육   대퇴사두근  │ │
│ │                         │ │
│ │ 자세 평가: ★★★★☆ 양호    │ │
│ │ "무릎 각도를 조금 더       │ │
│ │  깊게 하면 효과적입니다"   │ │
│ └─────────────────────────┘ │
│                             │
│ [  운동 기록 저장  ]          │
│ [  다시 촬영  ]              │
└─────────────────────────────┘
```

### 설명
- **영상 촬영/선택**: 운동 영상을 직접 촬영하거나 갤러리에서 선택한다.
- **운동 종류 자동 감지**: AI가 영상 내 동작을 분석하여 운동 종류(스쿼트, 런지, 푸쉬업 등)를 자동 인식한다.
- **소모 칼로리 추정**: 운동 종류, 시간, 반복 횟수, 사용자 체중을 기반으로 소모 칼로리를 계산한다.
- **자세 평가**: AI 포즈 추정(Pose Estimation)으로 운동 자세를 평가하고 개선점을 제안한다.
- **운동 기록 저장**: HealthRecordService에 운동 기록을 저장한다.

### UX 포인트
- 영상 길이 제한: 최대 3분 (분석 정확도 및 처리 시간 고려)
- 실시간 분석 미리보기: 촬영 중 포즈 스켈레톤 오버레이 (Phase 2 후반)
- 인식 불가 시: "운동 동작을 인식할 수 없습니다" + 수동 운동 종류 선택 폴백

### 접근성
- 영상 재생 컨트롤: 재생/일시정지/탐색 접근성 라벨 제공
- 분석 결과: 스크린리더 "스쿼트, 15회, 소모 칼로리 45킬로칼로리"
- 자세 평가 별점: "자세 평가 5점 중 4점, 양호"

### 음성 안내 (TTS)
> "운동 분석입니다. 운동 영상을 촬영하거나 선택하면 AI가 운동 종류와 소모 칼로리를 분석합니다."

---

## 네비게이션 흐름

```
┌──────────────┐     ┌──────────────┐
│  AI 코치 메인 │────▶│  AI 채팅 상담 │
│  /coach       │     │  /chat        │
└──────┬───────┘     └──────────────┘
       │
       ├────────────▶ ┌──────────────┐
       │              │ 음식 사진 분석 │
       │              │ /coach/food   │
       │              └──────────────┘
       │
       └────────────▶ ┌──────────────┐
                      │ 운동 영상 분석 │
                      │ /coach/exercise│
                      └──────────────┘
```

- **Coach → Chat**: AI 상담 시작 버튼 탭 시 채팅 화면 전환
- **Coach → Food Analysis**: 식이 관리 카테고리 진입 또는 직접 접근
- **Coach → Exercise Analysis**: 운동 코칭 카테고리 진입 또는 직접 접근

---

## 기술 참조

- `frontend/flutter-app/lib/features/ai_coach/` AI 코치 화면 구현
- `frontend/flutter-app/lib/features/chat/presentation/chat_screen.dart` 채팅 화면
- `backend/shared/proto/manpasik.proto` HealthRecordService, AICoachService
- AI 분석 API: 음식 인식 (Vision API), 운동 포즈 추정 (MediaPipe/MLKit)
- 스트리밍 응답: gRPC 서버 스트림 또는 SSE 프로토콜

---

## 접근성 종합

- 모든 버튼 최소 터치 영역 48x48dp
- 색상 대비 WCAG AA 준수 (4.5:1 이상)
- 색각 이상 대응: 아이콘 + 텍스트 라벨 병용
- AI 응답 텍스트: 기본 16sp, 시니어 모드 시 24sp
- 면책 배너: 접근성 우선순위 최상위 설정
